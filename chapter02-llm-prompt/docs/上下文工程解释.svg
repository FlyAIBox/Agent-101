<svg width="1200" height="860" viewBox="0 0 1200 860" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <!-- 箭头样式 -->
    <marker id="arrow" markerWidth="12" markerHeight="12" refX="10" refY="6" orient="auto-start-reverse">
      <path d="M0,0 L12,6 L0,12 Z" fill="#555"/>
    </marker>
    <!-- 通用阴影 -->
    <filter id="softShadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="0" dy="2" stdDeviation="3" flood-color="#000" flood-opacity="0.15"/>
    </filter>
    <!-- 背景渐变 -->
    <linearGradient id="bg1" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#EAF2FF"/>
      <stop offset="100%" stop-color="#F7FAFF"/>
    </linearGradient>
    <linearGradient id="bg2" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#EAFBF3"/>
      <stop offset="100%" stop-color="#F7FFFB"/>
    </linearGradient>
    <linearGradient id="bg3" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#FFF2EA"/>
      <stop offset="100%" stop-color="#FFFAF7"/>
    </linearGradient>
    <!-- 样式 -->
    <style>
      .en { font-family: "Times New Roman", Times, serif; }
      .cn { font-family: "SimSun", "Songti SC", serif; }
      .math { font-family: "Cambria Math","STIX Two Math","STIXGeneral","Times New Roman", serif; }
      .title { font-size: 28px; font-weight: 700; fill: #222; }
      .subtitle { font-size: 18px; font-weight: 600; fill: #333; }
      .laneTitle { font-size: 22px; font-weight: 700; fill: #111; }
      .laneHead { font-size: 16px; font-weight: 600; fill: #222; }
      .small { font-size: 14px; fill: #444; }
      .mini { font-size: 13px; fill: #444; }
      .box { fill: #fff; stroke: #c9d2e0; stroke-width: 1.2; rx: 10; filter: url(#softShadow); }
      .flow { stroke: #555; stroke-width: 2; marker-end: url(#arrow); }
    </style>
  </defs>

  <!-- 标题 -->
  <text x="600" y="44" text-anchor="middle" class="en title">Context Engineering for LLMs</text>
  <text x="600" y="74" text-anchor="middle" class="cn subtitle">将“上下文工程”比喻为电影布景：台词（提示）只是瞬间，布景为瞬间服务</text>

  <!-- 三列背景 -->
  <rect x="36"  y="100" width="356" height="680" rx="16" fill="url(#bg1)"/>
  <rect x="422" y="100" width="356" height="680" rx="16" fill="url(#bg2)"/>
  <rect x="808" y="100" width="356" height="680" rx="16" fill="url(#bg3)"/>

  <!-- 左列：提示工程（台词） -->
  <text x="214" y="128" text-anchor="middle" class="en laneTitle">Prompt Engineering</text>
  <text x="214" y="152" text-anchor="middle" class="cn laneHead">类比：演员的“台词”（瞬时输入）</text>

  <rect x="64" y="170" width="320" height="90" class="box"/>
  <text x="224" y="198" text-anchor="middle" class="cn small">目标：用清晰、具体的指令触发期望行为</text>
  <text x="224" y="222" text-anchor="middle" class="en small">System / User / Tool Prompts</text>

  <rect x="64" y="276" width="320" height="120" class="box"/>
  <text x="224" y="304" text-anchor="middle" class="cn small">常见技巧</text>
  <text x="224" y="328" text-anchor="middle" class="en small">Role, Constraints, Steps, Examples</text>
  <text x="224" y="352" text-anchor="middle" class="cn mini">注意：台词再好，也需布景支持（知识、检索、记忆）</text>

  <!-- 中列：上下文工程（布景） -->
  <text x="600" y="128" text-anchor="middle" class="en laneTitle">Context Engineering</text>
  <text x="600" y="152" text-anchor="middle" class="cn laneHead">类比：电影“布景”（为瞬间搭建环境与细节）</text>

  <rect x="450" y="170" width="320" height="110" class="box"/>
  <text x="610" y="198" text-anchor="middle" class="cn small">组成：检索文档、记忆、工具描述、数据片段、约束</text>
  <text x="610" y="222" text-anchor="middle" class="en small">RAG, Memory, Tools, Metadata, Constraints</text>

  <rect x="450" y="294" width="320" height="156" class="box"/>
  <text x="610" y="318" text-anchor="middle" class="cn small">令牌预算（窗口约束）</text>
  <text x="610" y="342" text-anchor="middle" class="math small">tokens_in = tokens_prompt + tokens_context + tokens_tools</text>
  <text x="610" y="366" text-anchor="middle" class="math small">tokens_total = tokens_in + tokens_output ≤ 窗口 W</text>
  <text x="610" y="390" text-anchor="middle" class="cn mini">策略：优先高相关、高信息密度的材料；冗余先删</text>

  <rect x="450" y="456" width="320" height="120" class="box"/>
  <text x="610" y="480" text-anchor="middle" class="cn small">质量：相关性×覆盖度×可信度</text>
  <text x="610" y="504" text-anchor="middle" class="en small">Relevance × Coverage × Trustworthiness</text>
  <text x="610" y="528" text-anchor="middle" class="cn mini">可实现方式：MMR 选文、去重、时间/来源优先级</text>

  <!-- 右列：语言学压缩 -->
  <text x="986" y="128" text-anchor="middle" class="en laneTitle">Linguistics Compression</text>
  <text x="986" y="152" text-anchor="middle" class="cn laneHead">在有限窗口内：用更少词传达更多信息</text>

  <rect x="836" y="170" width="320" height="120" class="box"/>
  <text x="996" y="194" text-anchor="middle" class="cn small">定义：最大化单位令牌的信息密度</text>
  <text x="996" y="218" text-anchor="middle" class="math small">信息密度 D = I / tokens</text>
  <text x="996" y="242" text-anchor="middle" class="cn mini">I 可由对答案的互信息近似，实践以困惑度/压缩率衡量</text>

  <rect x="836" y="300" width="320" height="150" class="box"/>
  <text x="996" y="324" text-anchor="middle" class="cn small">压缩与节省</text>
  <text x="996" y="348" text-anchor="middle" class="math small">压缩率 r = L_raw / L_comp</text>
  <text x="996" y="372" text-anchor="middle" class="math small">令牌节省率 S = 1 - 1/r</text>
  <text x="996" y="396" text-anchor="middle" class="cn mini">技巧：合并同义、去停用冗余、保留关键实体与数值</text>

  <rect x="836" y="456" width="320" height="160" class="box"/>
  <text x="996" y="480" text-anchor="middle" class="cn small">可量化指标</text>
  <text x="996" y="504" text-anchor="middle" class="math small">困惑度 PP = exp( - (1/N) Σ log p(w_i) )</text>
  <text x="996" y="528" text-anchor="middle" class="math small">成本 Cost ≈ (tokens_in + tokens_out) × c</text>
  <text x="996" y="552" text-anchor="middle" class="cn mini">目标：在不损失关键信息的前提下降低 PP 与成本</text>

  <!-- 流程：台词 + 布景 → LLM → 输出 -->
  <rect x="120" y="616" width="220" height="64" class="box"/>
  <text x="230" y="642" text-anchor="middle" class="en small">Prompts</text>
  <text x="230" y="664" text-anchor="middle" class="cn mini">台词</text>

  <rect x="508" y="616" width="220" height="64" class="box"/>
  <text x="618" y="642" text-anchor="middle" class="en small">Context (RAG/Memory/Tools)</text>
  <text x="618" y="664" text-anchor="middle" class="cn mini">布景</text>

  <line x1="340" y1="648" x2="508" y2="648" class="flow"/>
  <line x1="728" y1="648" x2="840" y2="648" class="flow"/>

  <rect x="840" y="616" width="220" height="64" class="box"/>
  <text x="950" y="642" text-anchor="middle" class="en small">LLM</text>
  <text x="950" y="664" text-anchor="middle" class="cn mini">模型推理</text>

  <line x1="1060" y1="648" x2="1120" y2="648" class="flow"/>
  <text x="1136" y="652" class="en small">Output</text>

  <!-- 角标（上移避免重叠） -->
  <text x="1160" y="744" text-anchor="end" class="en small" fill="#666">BY 萤火AI百宝箱</text>

  <!-- 新增：基本概念（定义） -->
  <rect x="36" y="760" width="1128" height="90" rx="10" class="box"/>
  <text x="52" y="788" class="cn small">• 提示词：发送给AI的问题或者指令文本</text>
  <text x="52" y="812" class="cn small">• 提示词工程：系统化地设计、测试、优化提示词的过程。</text>
  <text x="52" y="836" class="cn small">• 上下文工程：为大语言模型提供恰当的上下文、帮助模型高效完成任务的科学和艺术。</text>
</svg>
