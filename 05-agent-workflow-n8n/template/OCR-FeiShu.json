{
  "name": "OCR",
  "nodes": [
    {
      "parameters": {
        "formTitle": "ä¸Šä¼ å›¾ç‰‡",
        "formFields": {
          "values": [
            {
              "fieldLabel": "images",
              "fieldType": "file",
              "acceptFileTypes": ".jpg,.png"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.formTrigger",
      "typeVersion": 2.2,
      "position": [
        -480,
        220
      ],
      "id": "7c3cd707-4b45-4775-aab2-baf293e91557",
      "name": "Batch Image Upload",
      "webhookId": "b2c44ad4-75e5-462d-980b-35db11060745"
    },
    {
      "parameters": {
        "jsCode": "let results = [];\nfor (const item of $input.all()) {\n    // è·å– binary ä¸­çš„æ‰€æœ‰æ–‡ä»¶\n    for (const [key, binaryData] of Object.entries(item.binary)) {\n        results.push({\n            json: {\n                ...item.json,\n                currentFile: key, // æ·»åŠ å½“å‰å¤„ç†çš„æ–‡ä»¶æ ‡è¯†\n                filename: binaryData.fileName || key,\n                fileSize: binaryData.fileSize\n            },\n            binary: { \n                data: binaryData  // åªåŒ…å«å½“å‰æ–‡ä»¶çš„ binary æ•°æ®\n            }\n        });\n    }\n}\nreturn results;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -240,
        220
      ],
      "id": "05427da1-d4bd-4793-af7e-6e90e68d6605",
      "name": "Split Files to Items"
    },
    {
      "parameters": {
        "content": "### å°†å¤šä¸ªæ–‡ä»¶åˆ†å‰²æˆç‹¬ç«‹çš„ items \n",
        "height": 240,
        "width": 280,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -320,
        160
      ],
      "id": "0808e9fb-7da4-45c1-8429-986e3fed6312",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=AIzaSyB9jWMPsHY6kV71jCogbpeswzOEL-dvgHg",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"contents\": [\n    {\n      \"parts\": [\n        {\n          \"text\": \"è¯·æå–å›¾ç‰‡ä¸­çš„å…¨éƒ¨æ–‡æœ¬å†…å®¹ï¼Œä¸¥æ ¼ä¿æŒåŸæœ‰æ ¼å¼å’Œæ’ç‰ˆã€‚è¦æ±‚ï¼šä¿æŒåŸå§‹çš„è¡Œé—´è·ã€æ®µè½ç»“æ„å’Œç¼©è¿›ï¼Œä¿ç•™è¡¨æ ¼ã€åˆ—è¡¨ç­‰ç‰¹æ®Šæ ¼å¼ï¼Œä¸æ·»åŠ ä»»ä½•è§£é‡Šã€è¯´æ˜æˆ–é¢å¤–ç¬¦å·ï¼Œå¦‚é‡ä¸æ¸…æ™°æ–‡å­—ç”¨[?]æ ‡è®°ï¼Œç›´æ¥è¾“å‡ºæå–ç»“æœæ— éœ€å‰è¨€åè¯­ã€‚\"\n        },\n        {\n          \"inline_data\": {\n            \"mime_type\": \"image/jpeg\",\n            \"data\": \"{{ $('Convert to Base64').item.json.data }}\"\n          }\n        }\n      ]\n    }\n  ],\n  \"generationConfig\": {\n    \"temperature\": 1,\n    \"maxOutputTokens\": 65536\n  }\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        820,
        100
      ],
      "id": "075ad19f-3fc2-4389-8103-16321467afa2",
      "name": "Gemini OCR API"
    },
    {
      "parameters": {
        "content": "## ğŸ“‹ æ‰¹é‡ OCR å¤„ç†æµç¨‹\nğŸ”„ å¯¹æ¯å¼ ä¸Šä¼ çš„å›¾ç‰‡æ‰§è¡Œï¼š\n1. è½¬æ¢ä¸º Base64 æ ¼å¼\n2. å‘é€è‡³ Google Gemini API\n3. è¯†åˆ«å¹¶æå–æ–‡æœ¬å†…å®¹\n4. æ”¶é›† OCR ç»“æœåŒæ­¥åˆ°é£ä¹¦å¤šç»´è¡¨æ ¼\n\nğŸ’¡ å¾ªç¯ä¼šè‡ªåŠ¨å¤„ç†æ‰€æœ‰ä¸Šä¼ çš„å›¾ç‰‡æ–‡ä»¶\n\n",
        "height": 480,
        "width": 1240,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        0,
        -20
      ],
      "id": "5932d166-03f0-4246-9ca9-94efda33b326",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "operation": "binaryToPropery",
        "options": {
          "keepSource": "both"
        }
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        380,
        220
      ],
      "id": "7a790c83-a782-4dde-8eb9-a03ecce1e9e8",
      "name": "Convert to Base64"
    },
    {
      "parameters": {
        "resource": "bitable",
        "operation": "bitable:table:record:add",
        "app_toke": "VMoXbh9aMav6L4sWeRkcpmfynLd",
        "table_id": "tblhoyqA6BGOLnVH",
        "body": "={\n  \"fields\":{\n      \"æ–‡ä»¶å\": \"{{ $('Convert to Base64').item.json.filename }}\",\n      \"ä¸Šä¼ æ—¶é—´\":\"{{ $now.format('yyyy-MM-dd HH:mm:ssa')  }}\",\n      \"è¯†åˆ«æ–‡æœ¬\": {{ JSON.stringify($json.candidates[0].content.parts[0].text) }},\n      \"åŸå›¾ç‰‡\": [\n        {\n          \"file_token\": \"{{ $('Upload to Feishu Drive').item.json.data.file_token }}\"\n        }\n      ],\n      \"æ–‡ä»¶å¤§å°\": \"{{ $('Convert to Base64').item.json.fileSize }}\"\n    }\n}"
      },
      "type": "n8n-nodes-feishu-lite.feishuNode",
      "typeVersion": 1,
      "position": [
        1020,
        220
      ],
      "id": "1c7f77ce-f795-42f2-b18b-9bc6b47ccd67",
      "name": "Save to Feishu Sheet",
      "credentials": {
        "feishuCredentialsApi": {
          "id": "BOKKsnzx1dTScsi9",
          "name": "Feishu Credentials account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        80,
        220
      ],
      "id": "ecd34bd3-a7ed-4bff-a107-398fb69a496d",
      "name": "Process Each Image"
    },
    {
      "parameters": {
        "resource": "space",
        "operation": "space:upload",
        "parent_type": "bitable_image",
        "parent_node": "VMoXbh9aMav6L4sWeRkcpmfynLd",
        "fileFieldName": "=data",
        "file_name": "={{ $json.filename }}"
      },
      "type": "n8n-nodes-feishu-lite.feishuNode",
      "typeVersion": 1,
      "position": [
        600,
        220
      ],
      "id": "b2d906a1-12cd-4b54-9be5-a66d3dc5cf0d",
      "name": "Upload to Feishu Drive",
      "credentials": {
        "feishuCredentialsApi": {
          "id": "BOKKsnzx1dTScsi9",
          "name": "Feishu Credentials account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Batch Image Upload": {
      "main": [
        [
          {
            "node": "Split Files to Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Files to Items": {
      "main": [
        [
          {
            "node": "Process Each Image",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Process Each Image": {
      "main": [
        [],
        [
          {
            "node": "Convert to Base64",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to Base64": {
      "main": [
        [
          {
            "node": "Upload to Feishu Drive",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Upload to Feishu Drive": {
      "main": [
        [
          {
            "node": "Gemini OCR API",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini OCR API": {
      "main": [
        [
          {
            "node": "Save to Feishu Sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Save to Feishu Sheet": {
      "main": [
        []
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "4e159621-7ad1-4be5-9924-d2229c2eceac",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "65f35d0ae4b05236aca367064e568cbb1b37a05c0f8b1714de557aef0becbe95"
  },
  "id": "wXDFVRWQLafMQwgu",
  "tags": [
    {
      "createdAt": "2025-07-15T07:28:23.497Z",
      "updatedAt": "2025-07-15T07:28:23.497Z",
      "id": "JJ7MXl6bL0HM32F4",
      "name": "Gemini"
    },
    {
      "createdAt": "2025-07-15T07:28:23.514Z",
      "updatedAt": "2025-07-15T07:28:23.514Z",
      "id": "V1PmSlniEGIv9M3I",
      "name": "OCR"
    }
  ]
}